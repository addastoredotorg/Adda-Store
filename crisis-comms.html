<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Comms Message Drafter | Professional Customer Communication Tool for Small Businesses</title>
    <meta name="description" content="Crisis Comms Message Drafter: A stress-free tool for small businesses to create professional customer communications during challenges. Use templates and guided steps to draft transparent, apologetic messages that preserve customer trust and business reputation.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #4a7bc8;
            --accent-color: #ff6b6b;
            --success-color: #4caf50;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --text-color: #495057;
            --border-color: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .logo i {
            font-size: 2.5rem;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .wizard-container {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .preview-container {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }

        .wizard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .step-indicator {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 0.7rem;
            background-color: var(--light-color);
            border-radius: 5px;
            font-weight: 600;
            position: relative;
            transition: var(--transition);
        }

        .step.active {
            background-color: var(--primary-color);
            color: white;
        }

        .step.completed {
            background-color: var(--success-color);
            color: white;
        }

        .step-form {
            display: none;
        }

        .step-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.2);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .scenario-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .scenario-card {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            text-align: center;
        }

        .scenario-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .scenario-card.selected {
            border-color: var(--primary-color);
            background-color: rgba(44, 90, 160, 0.1);
        }

        .scenario-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .urgency-indicator {
            display: inline-block;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .urgency-high {
            background-color: #ffebee;
            color: #d32f2f;
        }

        .urgency-medium {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .urgency-low {
            background-color: #e8f5e8;
            color: #388e3c;
        }

        .tone-options {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .tone-option {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .tone-option:hover {
            border-color: var(--primary-color);
        }

        .tone-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(44, 90, 160, 0.1);
        }

        .tone-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .channel-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .channel-option {
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .channel-option:hover {
            border-color: var(--primary-color);
        }

        .channel-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(44, 90, 160, 0.1);
        }

        .channel-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .help-tip {
            background-color: #e3f2fd;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            font-size: 0.9rem;
            border-left: 4px solid var(--primary-color);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #43a047;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .message-preview {
            flex-grow: 1;
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
            min-height: 300px;
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
            line-height: 1.7;
            border: 1px solid var(--border-color);
        }

        .export-options {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .export-btn {
            flex: 1;
            text-align: center;
        }

        .tone-feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .tone-positive {
            background-color: #e8f5e8;
            border-left: 4px solid var(--success-color);
        }

        .tone-warning {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .tone-negative {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
        }

        .length-indicator {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #666;
        }

        .length-good {
            color: var(--success-color);
        }

        .length-warning {
            color: #ff9800;
        }

        .length-bad {
            color: #f44336;
        }

        footer {
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 480px) {
            .scenario-cards {
                grid-template-columns: 1fr;
            }
            
            .tone-options, .export-options {
                flex-direction: column;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="app-container">
            <div class="logo">
                <i class="fas fa-comments"></i>
                <div>
                    <h1>Crisis Comms Message Drafter</h1>
                    <p class="tagline">Professional communication tool for small businesses during challenging situations</p>
                </div>
            </div>
        </div>
    </header>

    <div class="app-container">
        <div class="main-content">
            <section class="wizard-container">
                <div class="wizard-header">
                    <h2>Create Your Message</h2>
                    <span id="stepCounter">Step 1 of 5</span>
                </div>

                <div class="step-indicator">
                    <div class="step active" id="step1Indicator">1. Scenario</div>
                    <div class="step" id="step2Indicator">2. Details</div>
                    <div class="step" id="step3Indicator">3. Audience</div>
                    <div class="step" id="step4Indicator">4. Tone</div>
                    <div class="step" id="step5Indicator">5. Review</div>
                </div>

                <!-- Step 1: Scenario Selection -->
                <div class="step-form active" id="step1">
                    <h3>What type of situation are you facing?</h3>
                    <p class="help-tip">
                        <strong>Tip:</strong> Select the scenario that best matches your situation. This will help us provide the most appropriate template.
                    </p>
                    
                    <div class="scenario-cards">
                        <div class="scenario-card" data-scenario="shipping-delay">
                            <div class="scenario-icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <h4>Shipping Delay</h4>
                            <div class="urgency-indicator urgency-medium">Respond within 24h</div>
                        </div>
                        
                        <div class="scenario-card" data-scenario="service-outage">
                            <div class="scenario-icon">
                                <i class="fas fa-server"></i>
                            </div>
                            <h4>Service Outage</h4>
                            <div class="urgency-indicator urgency-high">Respond immediately</div>
                        </div>
                        
                        <div class="scenario-card" data-scenario="mistake-error">
                            <div class="scenario-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h4>Mistake/Error</h4>
                            <div class="urgency-indicator urgency-high">Respond within 12h</div>
                        </div>
                        
                        <div class="scenario-card" data-scenario="product-issue">
                            <div class="scenario-icon">
                                <i class="fas fa-box-open"></i>
                            </div>
                            <h4>Product Issue</h4>
                            <div class="urgency-indicator urgency-medium">Respond within 24h</div>
                        </div>
                        
                        <div class="scenario-card" data-scenario="custom">
                            <div class="scenario-icon">
                                <i class="fas fa-edit"></i>
                            </div>
                            <h4>Custom Situation</h4>
                            <div class="urgency-indicator urgency-low">Respond appropriately</div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn" disabled>Previous</button>
                        <button class="btn" id="step1Next">Next</button>
                    </div>
                </div>

                <!-- Step 2: Situation Details -->
                <div class="step-form" id="step2">
                    <h3>Tell us about the situation</h3>
                    <p class="help-tip">
                        <strong>Tip:</strong> Be transparent but concise. Customers appreciate honesty about what happened.
                    </p>
                    
                    <div class="form-group">
                        <label for="businessName">Your Business Name</label>
                        <input type="text" id="businessName" placeholder="Enter your business name">
                    </div>
                    
                    <div class="form-group">
                        <label for="situationDetails">What happened? (Be specific but brief)</label>
                        <textarea id="situationDetails" placeholder="Describe the situation in 1-2 sentences"></textarea>
                        <div class="length-indicator" id="detailsLength">0/200 characters</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="impactDescription">How does this affect customers?</label>
                        <textarea id="impactDescription" placeholder="Explain the impact on customers"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="solutionPlan">What are you doing to fix it?</label>
                        <textarea id="solutionPlan" placeholder="Describe your solution or plan"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-secondary" id="step2Prev">Previous</button>
                        <button class="btn" id="step2Next">Next</button>
                    </div>
                </div>

                <!-- Step 3: Audience & Channel -->
                <div class="step-form" id="step3">
                    <h3>Who are you communicating with?</h3>
                    <p class="help-tip">
                        <strong>Tip:</strong> Different channels require different messaging styles. Email allows for more detail, while social media should be concise.
                    </p>
                    
                    <div class="form-group">
                        <label>Communication Channel</label>
                        <div class="channel-options">
                            <div class="channel-option" data-channel="email">
                                <div class="channel-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div>Email</div>
                            </div>
                            <div class="channel-option" data-channel="social-media">
                                <div class="channel-icon">
                                    <i class="fas fa-share-alt"></i>
                                </div>
                                <div>Social Media</div>
                            </div>
                            <div class="channel-option" data-channel="website">
                                <div class="channel-icon">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <div>Website</div>
                            </div>
                            <div class="channel-option" data-channel="sms">
                                <div class="channel-icon">
                                    <i class="fas fa-sms"></i>
                                </div>
                                <div>SMS</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="audienceScope">Who is affected?</label>
                        <select id="audienceScope">
                            <option value="all">All Customers</option>
                            <option value="specific">Specific Group of Customers</option>
                            <option value="individual">Individual Customer</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="customerNameGroup" style="display: none;">
                        <label for="customerName">Customer Name (Optional)</label>
                        <input type="text" id="customerName" placeholder="Enter customer name if known">
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-secondary" id="step3Prev">Previous</button>
                        <button class="btn" id="step3Next">Next</button>
                    </div>
                </div>

                <!-- Step 4: Tone & Style -->
                <div class="step-form" id="step4">
                    <h3>Choose your communication tone</h3>
                    <p class="help-tip">
                        <strong>Tip:</strong> The right tone can transform a negative situation into an opportunity to build trust.
                    </p>
                    
                    <div class="form-group">
                        <label>Message Tone</label>
                        <div class="tone-options">
                            <div class="tone-option" data-tone="empathetic">
                                <div class="tone-icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <div>Empathetic</div>
                                <small>Warm, understanding, personal</small>
                            </div>
                            <div class="tone-option" data-tone="professional">
                                <div class="tone-icon">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <div>Professional</div>
                                <small>Formal, corporate, polished</small>
                            </div>
                            <div class="tone-option" data-tone="conversational">
                                <div class="tone-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div>Conversational</div>
                                <small>Friendly, casual, approachable</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalNotes">Additional Notes (Optional)</label>
                        <textarea id="additionalNotes" placeholder="Any specific phrases or points you want to include?"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-secondary" id="step4Prev">Previous</button>
                        <button class="btn" id="step4Next">Next</button>
                    </div>
                </div>

                <!-- Step 5: Review & Export -->
                <div class="step-form" id="step5">
                    <h3>Review and finalize your message</h3>
                    <p class="help-tip">
                        <strong>Tip:</strong> Read through your message to ensure it sounds authentic to your business voice.
                    </p>
                    
                    <div class="form-group">
                        <label for="finalMessageEdit">Final Message (You can edit directly)</label>
                        <textarea id="finalMessageEdit"></textarea>
                        <div class="tone-feedback tone-positive" id="toneFeedback">
                            <strong>Tone Analysis:</strong> Your message demonstrates good transparency and accountability.
                        </div>
                        <div class="length-indicator" id="finalLength">0 characters</div>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-secondary" id="step5Prev">Previous</button>
                        <button class="btn btn-success" id="exportMessage">Export Message</button>
                    </div>
                </div>
            </section>

            <section class="preview-container">
                <div class="preview-header">
                    <h2>Message Preview</h2>
                    <span id="previewChannel">Email</span>
                </div>
                
                <div class="message-preview" id="messagePreview">
                    Your message will appear here as you complete the steps.
                </div>
                
                <div class="export-options">
                    <button class="btn export-btn" id="copyClipboard">
                        <i class="fas fa-copy"></i> Copy to Clipboard
                    </button>
                    <button class="btn btn-secondary export-btn" id="downloadText">
                        <i class="fas fa-download"></i> Download as Text
                    </button>
                </div>
                
                <div class="help-tip" style="margin-top: 1.5rem;">
                    <strong>Best Practice Reminder:</strong>
                    <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
                        <li>Acknowledge the problem quickly</li>
                        <li>Apologize sincerely</li>
                        <li>Explain briefly and transparently</li>
                        <li>Focus on the solution</li>
                        <li>Provide clear next steps</li>
                    </ul>
                </div>
            </section>
        </div>
    </div>

    <footer>
        <div class="app-container">
            <p>Crisis Comms Message Drafter &copy; 2023 | Turning challenging situations into trust-building opportunities</p>
            <p style="margin-top: 0.5rem; opacity: 0.8;">Your drafts are stored privately in your browser</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const stepForms = document.querySelectorAll('.step-form');
            const stepIndicators = document.querySelectorAll('.step');
            const stepCounter = document.getElementById('stepCounter');
            const messagePreview = document.getElementById('messagePreview');
            const previewChannel = document.getElementById('previewChannel');
            const finalMessageEdit = document.getElementById('finalMessageEdit');
            const toneFeedback = document.getElementById('toneFeedback');
            const detailsLength = document.getElementById('detailsLength');
            const finalLength = document.getElementById('finalLength');
            
            // Navigation buttons
            const step1Next = document.getElementById('step1Next');
            const step2Prev = document.getElementById('step2Prev');
            const step2Next = document.getElementById('step2Next');
            const step3Prev = document.getElementById('step3Prev');
            const step3Next = document.getElementById('step3Next');
            const step4Prev = document.getElementById('step4Prev');
            const step4Next = document.getElementById('step4Next');
            const step5Prev = document.getElementById('step5Prev');
            const exportMessage = document.getElementById('exportMessage');
            
            // Export buttons
            const copyClipboard = document.getElementById('copyClipboard');
            const downloadText = document.getElementById('downloadText');
            
            // Form elements
            const scenarioCards = document.querySelectorAll('.scenario-card');
            const channelOptions = document.querySelectorAll('.channel-option');
            const toneOptions = document.querySelectorAll('.tone-option');
            const audienceScope = document.getElementById('audienceScope');
            const customerNameGroup = document.getElementById('customerNameGroup');
            const customerName = document.getElementById('customerName');
            const businessName = document.getElementById('businessName');
            const situationDetails = document.getElementById('situationDetails');
            const impactDescription = document.getElementById('impactDescription');
            const solutionPlan = document.getElementById('solutionPlan');
            const additionalNotes = document.getElementById('additionalNotes');
            
            // App State
            let currentStep = 1;
            let messageData = {
                scenario: '',
                businessName: '',
                situationDetails: '',
                impactDescription: '',
                solutionPlan: '',
                channel: 'email',
                audienceScope: 'all',
                customerName: '',
                tone: 'empathetic',
                additionalNotes: ''
            };
            
            // Templates for different scenarios
            const templates = {
                'shipping-delay': {
                    empathetic: `Dear {customerName},

I'm writing to personally apologize for the delay in shipping your recent order from {businessName}. 

We know how frustrating it can be to wait for a package, and I'm sorry for any inconvenience this has caused.

{situationDetails}

To make things right, {solutionPlan}

We'll send you another update as soon as your order ships. If you have any questions, please don't hesitate to reply to this email.

Thank you for your patience and understanding.

Sincerely,
The {businessName} Team`,
                    
                    professional: `Dear {customerName},

We are writing to inform you of a delay in the shipment of your order from {businessName}.

{situationDetails}

Please be assured that we are taking the following steps to resolve this issue: {solutionPlan}

We will notify you immediately once your order has shipped. We appreciate your business and apologize for any inconvenience.

Best regards,
{businessName} Customer Service`,
                    
                    conversational: `Hi {customerName},

We wanted to let you know there's been a slight delay with your order from {businessName}.

{situationDetails}

But don't worry! Here's what we're doing: {solutionPlan}

We'll keep you posted as soon as we have more news. Thanks for your patience!

Cheers,
The {businessName} Team`
                },
                
                'service-outage': {
                    empathetic: `Dear {customerName},

I want to sincerely apologize for the service disruption you may be experiencing with {businessName}. 

We understand how frustrating service interruptions can be, and we're truly sorry for the impact this is having on your experience.

{situationDetails}

Our team is working tirelessly to resolve this. {solutionPlan}

We will send another update as soon as service is fully restored. Thank you for your patience during this time.

Sincerely,
The {businessName} Team`,
                    
                    professional: `Service Update from {businessName}

We are currently experiencing a service outage that is affecting our platform.

{situationDetails}

Our technical team is actively working on a resolution. {solutionPlan}

We apologize for any disruption this may cause to your operations. We will provide another update within the hour.

Thank you for your patience.`,
                    
                    conversational: `Hey there,

Just a quick heads-up that we're currently experiencing some technical difficulties with {businessName}.

{situationDetails}

Our team is on it! {solutionPlan}

We're sorry for the hassle and really appreciate your patience while we get this sorted.

We'll keep you posted!

- The {businessName} Team`
                },
                
                // Additional templates would be defined here for other scenarios
                'default': {
                    empathetic: `Dear {customerName},

I'm writing to personally address {situationDetails}.

We sincerely apologize for any inconvenience or frustration this has caused.

{impactDescription}

To resolve this, we're taking the following steps: {solutionPlan}

Thank you for your understanding and for giving us the opportunity to make things right.

Sincerely,
{businessName}`,
                    
                    professional: `Important Update from {businessName}

We are writing to inform you about {situationDetails}.

{impactDescription}

We have implemented the following solution: {solutionPlan}

We apologize for any inconvenience and appreciate your business.

Best regards,
{businessName}`,
                    
                    conversational: `Hi {customerName},

We wanted to update you about {situationDetails}.

{impactDescription}

Here's what we're doing to fix it: {solutionPlan}

Thanks for your understanding - we really appreciate it!

- The {businessName} Team`
                }
            };
            
            // Initialize the app
            function init() {
                loadDraft();
                setupEventListeners();
                updateUI();
            }
            
            // Load draft from localStorage
            function loadDraft() {
                const savedDraft = localStorage.getItem('crisisCommsDraft');
                if (savedDraft) {
                    messageData = JSON.parse(savedDraft);
                    
                    // Populate form fields with saved data
                    if (messageData.businessName) businessName.value = messageData.businessName;
                    if (messageData.situationDetails) situationDetails.value = messageData.situationDetails;
                    if (messageData.impactDescription) impactDescription.value = messageData.impactDescription;
                    if (messageData.solutionPlan) solutionPlan.value = messageData.solutionPlan;
                    if (messageData.customerName) customerName.value = messageData.customerName;
                    if (messageData.additionalNotes) additionalNotes.value = messageData.additionalNotes;
                    
                    // Select appropriate options
                    if (messageData.scenario) {
                        document.querySelector(`.scenario-card[data-scenario="${messageData.scenario}"]`).classList.add('selected');
                    }
                    
                    if (messageData.channel) {
                        document.querySelector(`.channel-option[data-channel="${messageData.channel}"]`).classList.add('selected');
                        previewChannel.textContent = formatChannelName(messageData.channel);
                    }
                    
                    if (messageData.tone) {
                        document.querySelector(`.tone-option[data-tone="${messageData.tone}"]`).classList.add('selected');
                    }
                    
                    if (messageData.audienceScope) {
                        audienceScope.value = messageData.audienceScope;
                        toggleCustomerNameField();
                    }
                    
                    updatePreview();
                }
            }
            
            // Save draft to localStorage
            function saveDraft() {
                localStorage.setItem('crisisCommsDraft', JSON.stringify(messageData));
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Step navigation
                step1Next.addEventListener('click', () => navigateToStep(2));
                step2Prev.addEventListener('click', () => navigateToStep(1));
                step2Next.addEventListener('click', () => navigateToStep(3));
                step3Prev.addEventListener('click', () => navigateToStep(2));
                step3Next.addEventListener('click', () => navigateToStep(4));
                step4Prev.addEventListener('click', () => navigateToStep(3));
                step4Next.addEventListener('click', () => navigateToStep(5));
                step5Prev.addEventListener('click', () => navigateToStep(4));
                
                // Scenario selection
                scenarioCards.forEach(card => {
                    card.addEventListener('click', function() {
                        scenarioCards.forEach(c => c.classList.remove('selected'));
                        this.classList.add('selected');
                        messageData.scenario = this.getAttribute('data-scenario');
                        saveDraft();
                        updatePreview();
                    });
                });
                
                // Channel selection
                channelOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        channelOptions.forEach(o => o.classList.remove('selected'));
                        this.classList.add('selected');
                        messageData.channel = this.getAttribute('data-channel');
                        previewChannel.textContent = formatChannelName(messageData.channel);
                        saveDraft();
                        updatePreview();
                    });
                });
                
                // Tone selection
                toneOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        toneOptions.forEach(o => o.classList.remove('selected'));
                        this.classList.add('selected');
                        messageData.tone = this.getAttribute('data-tone');
                        saveDraft();
                        updatePreview();
                    });
                });
                
                // Form input changes
                businessName.addEventListener('input', function() {
                    messageData.businessName = this.value;
                    saveDraft();
                    updatePreview();
                });
                
                situationDetails.addEventListener('input', function() {
                    messageData.situationDetails = this.value;
                    detailsLength.textContent = `${this.value.length}/200 characters`;
                    if (this.value.length > 200) {
                        detailsLength.classList.add('length-bad');
                    } else if (this.value.length > 150) {
                        detailsLength.classList.add('length-warning');
                    } else {
                        detailsLength.classList.remove('length-bad', 'length-warning');
                        detailsLength.classList.add('length-good');
                    }
                    saveDraft();
                    updatePreview();
                });
                
                impactDescription.addEventListener('input', function() {
                    messageData.impactDescription = this.value;
                    saveDraft();
                    updatePreview();
                });
                
                solutionPlan.addEventListener('input', function() {
                    messageData.solutionPlan = this.value;
                    saveDraft();
                    updatePreview();
                });
                
                additionalNotes.addEventListener('input', function() {
                    messageData.additionalNotes = this.value;
                    saveDraft();
                    updatePreview();
                });
                
                audienceScope.addEventListener('change', function() {
                    messageData.audienceScope = this.value;
                    toggleCustomerNameField();
                    saveDraft();
                    updatePreview();
                });
                
                customerName.addEventListener('input', function() {
                    messageData.customerName = this.value;
                    saveDraft();
                    updatePreview();
                });
                
                finalMessageEdit.addEventListener('input', function() {
                    finalLength.textContent = `${this.value.length} characters`;
                    if (this.value.length > 1000) {
                        finalLength.classList.add('length-bad');
                    } else if (this.value.length > 700) {
                        finalLength.classList.add('length-warning');
                    } else {
                        finalLength.classList.remove('length-bad', 'length-warning');
                        finalLength.classList.add('length-good');
                    }
                    analyzeTone(this.value);
                });
                
                // Export functionality
                copyClipboard.addEventListener('click', copyToClipboard);
                downloadText.addEventListener('click', downloadAsText);
                exportMessage.addEventListener('click', finalizeMessage);
            }
            
            // Navigate between steps
            function navigateToStep(step) {
                // Validate current step before proceeding
                if (step > currentStep && !validateCurrentStep()) {
                    return;
                }
                
                // Update UI
                stepForms.forEach(form => form.classList.remove('active'));
                document.getElementById(`step${step}`).classList.add('active');
                
                stepIndicators.forEach(indicator => indicator.classList.remove('active', 'completed'));
                for (let i = 1; i <= step; i++) {
                    const indicator = document.getElementById(`step${i}Indicator`);
                    if (i < step) {
                        indicator.classList.add('completed');
                    } else {
                        indicator.classList.add('active');
                    }
                }
                
                currentStep = step;
                stepCounter.textContent = `Step ${step} of 5`;
                
                // Special handling for step 5
                if (step === 5) {
                    finalMessageEdit.value = generateMessage();
                    finalLength.textContent = `${finalMessageEdit.value.length} characters`;
                    analyzeTone(finalMessageEdit.value);
                }
                
                updatePreview();
            }
            
            // Validate current step before proceeding
            function validateCurrentStep() {
                switch(currentStep) {
                    case 1:
                        if (!messageData.scenario) {
                            alert('Please select a scenario to continue.');
                            return false;
                        }
                        break;
                    case 2:
                        if (!messageData.businessName || !messageData.situationDetails) {
                            alert('Please fill in all required fields.');
                            return false;
                        }
                        break;
                    case 3:
                        if (!messageData.channel) {
                            alert('Please select a communication channel.');
                            return false;
                        }
                        break;
                    case 4:
                        if (!messageData.tone) {
                            alert('Please select a message tone.');
                            return false;
                        }
                        break;
                }
                return true;
            }
            
            // Toggle customer name field based on audience scope
            function toggleCustomerNameField() {
                if (messageData.audienceScope === 'individual') {
                    customerNameGroup.style.display = 'block';
                } else {
                    customerNameGroup.style.display = 'none';
                    messageData.customerName = '';
                    customerName.value = '';
                }
            }
            
            // Format channel name for display
            function formatChannelName(channel) {
                const names = {
                    'email': 'Email',
                    'social-media': 'Social Media',
                    'website': 'Website Notice',
                    'sms': 'SMS'
                };
                return names[channel] || channel;
            }
            
            // Generate the message based on current data
            function generateMessage() {
                let template = templates.default;
                
                if (messageData.scenario && templates[messageData.scenario]) {
                    template = templates[messageData.scenario];
                }
                
                let messageTemplate = template[messageData.tone] || template.empathetic;
                
                // Replace placeholders with actual data
                let message = messageTemplate
                    .replace(/{businessName}/g, messageData.businessName || '[Your Business Name]')
                    .replace(/{customerName}/g, getCustomerGreeting())
                    .replace(/{situationDetails}/g, messageData.situationDetails || '[Describe what happened]')
                    .replace(/{impactDescription}/g, messageData.impactDescription || '[Explain the impact]')
                    .replace(/{solutionPlan}/g, messageData.solutionPlan || '[Describe your solution]');
                
                // Apply channel-specific formatting
                message = formatForChannel(message, messageData.channel);
                
                return message;
            }
            
            // Get appropriate customer greeting
            function getCustomerGreeting() {
                if (messageData.audienceScope === 'individual' && messageData.customerName) {
                    return messageData.customerName;
                } else if (messageData.audienceScope === 'specific') {
                    return 'valued customers';
                } else {
                    return 'valued customer';
                }
            }
            
            // Format message for specific channel
            function formatForChannel(message, channel) {
                switch(channel) {
                    case 'social-media':
                        // Shorten for social media
                        if (message.length > 280) {
                            message = message.substring(0, 277) + '...';
                        }
                        // Add hashtag for visibility
                        message += '\n\n#ServiceUpdate';
                        break;
                    case 'sms':
                        // Ultra concise for SMS
                        const sentences = message.split('.');
                        let shortMessage = '';
                        for (let i = 0; i < Math.min(2, sentences.length); i++) {
                            shortMessage += sentences[i] + '. ';
                        }
                        message = shortMessage.trim();
                        break;
                    case 'website':
                        // Add HTML formatting for website
                        message = message.replace(/\n/g, '<br>');
                        break;
                }
                return message;
            }
            
            // Update the message preview
            function updatePreview() {
                if (currentStep >= 2) {
                    messagePreview.textContent = generateMessage();
                }
            }
            
            // Analyze message tone and provide feedback
            function analyzeTone(message) {
                let feedback = '';
                let toneClass = 'tone-positive';
                
                // Simple tone analysis based on keywords
                const positiveWords = ['apologize', 'sorry', 'understand', 'appreciate', 'thank', 'resolve', 'fix', 'improve'];
                const negativeWords = ['blame', 'fault', 'unfortunately', 'cannot', 'unable', 'problem', 'issue', 'error'];
                
                let positiveCount = 0;
                let negativeCount = 0;
                
                positiveWords.forEach(word => {
                    if (message.toLowerCase().includes(word)) positiveCount++;
                });
                
                negativeWords.forEach(word => {
                    if (message.toLowerCase().includes(word)) negativeCount++;
                });
                
                if (positiveCount >= 3) {
                    feedback = 'Your message demonstrates good transparency and accountability.';
                    toneClass = 'tone-positive';
                } else if (positiveCount >= 1) {
                    feedback = 'Your message could be more empathetic. Consider adding more understanding language.';
                    toneClass = 'tone-warning';
                } else {
                    feedback = 'Your message may come across as defensive. Try adding more empathetic language.';
                    toneClass = 'tone-negative';
                }
                
                // Check for solution orientation
                if (!message.includes('resolve') && !message.includes('fix') && !message.includes('solution')) {
                    feedback += ' Make sure to clearly explain how you\'re solving the problem.';
                    if (toneClass !== 'tone-negative') toneClass = 'tone-warning';
                }
                
                toneFeedback.textContent = `Tone Analysis: ${feedback}`;
                toneFeedback.className = `tone-feedback ${toneClass}`;
            }
            
            // Copy message to clipboard
            function copyToClipboard() {
                const message = finalMessageEdit.value || generateMessage();
                navigator.clipboard.writeText(message).then(() => {
                    // Show success feedback
                    const originalText = copyClipboard.innerHTML;
                    copyClipboard.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        copyClipboard.innerHTML = originalText;
                    }, 2000);
                });
            }
            
            // Download message as text file
            function downloadAsText() {
                const message = finalMessageEdit.value || generateMessage();
                const blob = new Blob([message], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `crisis-message-${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            // Finalize and export the message
            function finalizeMessage() {
                // Save the final edited message
                messageData.finalMessage = finalMessageEdit.value;
                saveDraft();
                
                // Show success message
                alert('Your crisis communication message has been finalized and saved! You can copy it to clipboard or download it as a text file.');
            }
            
            // Update UI based on current state
            function updateUI() {
                // Initial UI updates would go here
            }
            
            // Initialize the application
            init();
        });
    </script>
</body>
</html>
